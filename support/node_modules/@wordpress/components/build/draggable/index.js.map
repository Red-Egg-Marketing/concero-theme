{"version":3,"sources":["@wordpress/components/src/draggable/index.js"],"names":["dragImageClass","cloneWrapperClass","cloneHeightTransformationBreakpoint","clonePadding","Draggable","arguments","onDragStart","bind","onDragOver","onDragEnd","resetDragState","event","props","noop","preventDefault","setTimeout","cloneWrapper","style","top","parseInt","clientY","cursorTop","left","clientX","cursorLeft","cloneClassname","elementId","transferData","element","document","getElementById","dataTransfer","setDragImage","dragImage","createElement","id","classList","add","body","appendChild","removeChild","setData","JSON","stringify","elementRect","getBoundingClientRect","elementWrapper","parentNode","elementTopOffset","elementLeftOffset","clone","cloneNode","width","height","transform","transformOrigin","Array","from","querySelectorAll","forEach","child","addEventListener","removeEventListener","remove","children","onDraggableStart","onDraggableEnd","Component"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { noop } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { withSafeTimeout } from '@wordpress/compose';\n\nconst dragImageClass = 'components-draggable__invisible-drag-image';\nconst cloneWrapperClass = 'components-draggable__clone';\nconst cloneHeightTransformationBreakpoint = 700;\nconst clonePadding = 0;\n\nclass Draggable extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.onDragStart = this.onDragStart.bind( this );\n\t\tthis.onDragOver = this.onDragOver.bind( this );\n\t\tthis.onDragEnd = this.onDragEnd.bind( this );\n\t\tthis.resetDragState = this.resetDragState.bind( this );\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis.resetDragState();\n\t}\n\n\t/**\n\t * Removes the element clone, resets cursor, and removes drag listener.\n\t *\n\t * @param  {Object} event The non-custom DragEvent.\n\t */\n\tonDragEnd( event ) {\n\t\tconst { onDragEnd = noop } = this.props;\n\t\tevent.preventDefault();\n\n\t\tthis.resetDragState();\n\t\tthis.props.setTimeout( onDragEnd );\n\t}\n\n\t/**\n\t * Updates positioning of element clone based on mouse movement during dragging.\n\t *\n\t * @param  {Object} event The non-custom DragEvent.\n\t */\n\tonDragOver( event ) {\n\t\tthis.cloneWrapper.style.top = `${\n\t\t\tparseInt( this.cloneWrapper.style.top, 10 ) +\n\t\t\tevent.clientY -\n\t\t\tthis.cursorTop\n\t\t}px`;\n\t\tthis.cloneWrapper.style.left = `${\n\t\t\tparseInt( this.cloneWrapper.style.left, 10 ) +\n\t\t\tevent.clientX -\n\t\t\tthis.cursorLeft\n\t\t}px`;\n\n\t\t// Update cursor coordinates.\n\t\tthis.cursorLeft = event.clientX;\n\t\tthis.cursorTop = event.clientY;\n\t}\n\n\t/**\n\t * This method does a couple of things:\n\t *\n\t * - Clones the current element and spawns clone over original element.\n\t * - Adds a fake temporary drag image to avoid browser defaults.\n\t * - Sets transfer data.\n\t * - Adds dragover listener.\n\t *\n\t * @param  {Object} event The non-custom DragEvent.\n\t */\n\tonDragStart( event ) {\n\t\tconst {\n\t\t\tcloneClassname,\n\t\t\telementId,\n\t\t\ttransferData,\n\t\t\tonDragStart = noop,\n\t\t} = this.props;\n\t\tconst element = document.getElementById( elementId );\n\t\tif ( ! element ) {\n\t\t\tevent.preventDefault();\n\t\t\treturn;\n\t\t}\n\n\t\t// Set a fake drag image to avoid browser defaults. Remove from DOM\n\t\t// right after. event.dataTransfer.setDragImage is not supported yet in\n\t\t// IE, we need to check for its existence first.\n\t\tif ( 'function' === typeof event.dataTransfer.setDragImage ) {\n\t\t\tconst dragImage = document.createElement( 'div' );\n\t\t\tdragImage.id = `drag-image-${ elementId }`;\n\t\t\tdragImage.classList.add( dragImageClass );\n\t\t\tdocument.body.appendChild( dragImage );\n\t\t\tevent.dataTransfer.setDragImage( dragImage, 0, 0 );\n\t\t\tthis.props.setTimeout( () => {\n\t\t\t\tdocument.body.removeChild( dragImage );\n\t\t\t} );\n\t\t}\n\n\t\tevent.dataTransfer.setData( 'text', JSON.stringify( transferData ) );\n\n\t\t// Prepare element clone and append to element wrapper.\n\t\tconst elementRect = element.getBoundingClientRect();\n\t\tconst elementWrapper = element.parentNode;\n\t\tconst elementTopOffset = parseInt( elementRect.top, 10 );\n\t\tconst elementLeftOffset = parseInt( elementRect.left, 10 );\n\t\tconst clone = element.cloneNode( true );\n\t\tclone.id = `clone-${ elementId }`;\n\t\tthis.cloneWrapper = document.createElement( 'div' );\n\t\tthis.cloneWrapper.classList.add( cloneWrapperClass );\n\t\tif ( cloneClassname ) {\n\t\t\tthis.cloneWrapper.classList.add( cloneClassname );\n\t\t}\n\t\tthis.cloneWrapper.style.width = `${\n\t\t\telementRect.width + clonePadding * 2\n\t\t}px`;\n\n\t\tif ( elementRect.height > cloneHeightTransformationBreakpoint ) {\n\t\t\t// Scale down clone if original element is larger than 700px.\n\t\t\tthis.cloneWrapper.style.transform = 'scale(0.5)';\n\t\t\tthis.cloneWrapper.style.transformOrigin = 'top left';\n\t\t\t// Position clone near the cursor.\n\t\t\tthis.cloneWrapper.style.top = `${ event.clientY - 100 }px`;\n\t\t\tthis.cloneWrapper.style.left = `${ event.clientX }px`;\n\t\t} else {\n\t\t\t// Position clone right over the original element (20px padding).\n\t\t\tthis.cloneWrapper.style.top = `${\n\t\t\t\telementTopOffset - clonePadding\n\t\t\t}px`;\n\t\t\tthis.cloneWrapper.style.left = `${\n\t\t\t\telementLeftOffset - clonePadding\n\t\t\t}px`;\n\t\t}\n\n\t\t// Hack: Remove iFrames as it's causing the embeds drag clone to freeze\n\t\tArray.from( clone.querySelectorAll( 'iframe' ) ).forEach( ( child ) =>\n\t\t\tchild.parentNode.removeChild( child )\n\t\t);\n\n\t\tthis.cloneWrapper.appendChild( clone );\n\t\telementWrapper.appendChild( this.cloneWrapper );\n\n\t\t// Mark the current cursor coordinates.\n\t\tthis.cursorLeft = event.clientX;\n\t\tthis.cursorTop = event.clientY;\n\t\t// Update cursor to 'grabbing', document wide.\n\t\tdocument.body.classList.add( 'is-dragging-components-draggable' );\n\t\tdocument.addEventListener( 'dragover', this.onDragOver );\n\n\t\tthis.props.setTimeout( onDragStart );\n\t}\n\n\t/**\n\t * Cleans up drag state when drag has completed, or component unmounts\n\t * while dragging.\n\t */\n\tresetDragState() {\n\t\t// Remove drag clone\n\t\tdocument.removeEventListener( 'dragover', this.onDragOver );\n\t\tif ( this.cloneWrapper && this.cloneWrapper.parentNode ) {\n\t\t\tthis.cloneWrapper.parentNode.removeChild( this.cloneWrapper );\n\t\t\tthis.cloneWrapper = null;\n\t\t}\n\n\t\t// Reset cursor.\n\t\tdocument.body.classList.remove( 'is-dragging-components-draggable' );\n\t}\n\n\trender() {\n\t\tconst { children } = this.props;\n\n\t\treturn children( {\n\t\t\tonDraggableStart: this.onDragStart,\n\t\t\tonDraggableEnd: this.onDragEnd,\n\t\t} );\n\t}\n}\n\nexport default withSafeTimeout( Draggable );\n"]}