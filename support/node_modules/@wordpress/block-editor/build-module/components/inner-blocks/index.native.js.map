{"version":3,"sources":["@wordpress/block-editor/src/components/inner-blocks/index.native.js"],"names":["pick","isEqual","Component","withSelect","withDispatch","synchronizeBlocksWithTemplate","withBlockContentContext","isShallowEqual","compose","ButtonBlockAppender","DefaultBlockAppender","BlockList","withBlockEditContext","InnerBlocks","arguments","state","templateInProcess","props","template","updateNestedSettings","templateLock","parentLock","undefined","innerBlocks","block","length","getTemplateLock","setState","prevProps","hasTemplateChanged","replaceInnerBlocks","nextBlocks","blockListSettings","allowedBlocks","newSettings","clientId","renderAppender","renderFooterAppender","__experimentalMoverDirection","parentWidth","horizontal","contentResizeMode","contentStyle","onAddBlock","onDeleteBlock","marginVertical","marginHorizontal","horizontalAlignment","context","select","ownProps","isBlockSelected","hasSelectedInnerBlock","getBlock","getBlockListSettings","getBlockRootClientId","rootClientId","hasOverlay","name","dispatch","updateBlockListSettings","templateInsertUpdatesSelection","blocks","settings","Content","BlockContent"],"mappings":";;;;;;;;;;;AAAA;;;AAGA,SAASA,IAAT,EAAeC,OAAf,QAA8B,QAA9B;AAEA;;;;AAGA,SAASC,SAAT,QAA0B,oBAA1B;AACA,SAASC,UAAT,EAAqBC,YAArB,QAAyC,iBAAzC;AACA,SACCC,6BAA6B,IAA7BA,8BADD,EAECC,uBAFD,QAGO,mBAHP;AAIA,OAAOC,cAAP,MAA2B,6BAA3B;AACA,SAASC,OAAT,QAAwB,oBAAxB;AAEA;;;;AAGA,OAAOC,mBAAP,MAAgC,yBAAhC;AACA,OAAOC,oBAAP,MAAiC,0BAAjC;AACA,OAAOC,SAAP,MAAsB,eAAtB;AACA,SAASC,oBAAT,QAAqC,uBAArC;;IAEMC,W;;;;;AACL,yBAAc;AAAA;;AAAA;;AACb,+BAAUC,SAAV;AACA,UAAKC,KAAL,GAAa;AACZC,MAAAA,iBAAiB,EAAE,CAAC,CAAE,MAAKC,KAAL,CAAWC;AADrB,KAAb;;AAGA,UAAKC,oBAAL;;AALa;AAMb;;;;sCAEiB;AAAA,wBACoB,KAAKF,KADzB;AAAA,UACTG,YADS,eACTA,YADS;AAAA,UACKC,UADL,eACKA,UADL;AAEjB,aAAOD,YAAY,KAAKE,SAAjB,GAA6BD,UAA7B,GAA0CD,YAAjD;AACA;;;wCAEmB;AAAA,UACXG,WADW,GACK,KAAKN,KAAL,CAAWO,KADhB,CACXD,WADW,EAEnB;;AACA,UAAKA,WAAW,CAACE,MAAZ,KAAuB,CAAvB,IAA4B,KAAKC,eAAL,OAA2B,KAA5D,EAAoE;AACnE,aAAKrB,6BAAL;AACA;;AAED,UAAK,KAAKU,KAAL,CAAWC,iBAAhB,EAAoC;AACnC,aAAKW,QAAL,CAAe;AACdX,UAAAA,iBAAiB,EAAE;AADL,SAAf;AAGA;AACD;;;uCAEmBY,S,EAAY;AAAA,yBACH,KAAKX,KADF;AAAA,UACvBC,QADuB,gBACvBA,QADuB;AAAA,UACbM,KADa,gBACbA,KADa;AAAA,UAEvBD,WAFuB,GAEPC,KAFO,CAEvBD,WAFuB;AAI/B,WAAKJ,oBAAL,GAJ+B,CAK/B;;AACA,UAAKI,WAAW,CAACE,MAAZ,KAAuB,CAAvB,IAA4B,KAAKC,eAAL,OAA2B,KAA5D,EAAoE;AACnE,YAAMG,kBAAkB,GAAG,CAAE5B,OAAO,CACnCiB,QADmC,EAEnCU,SAAS,CAACV,QAFyB,CAApC;;AAIA,YAAKW,kBAAL,EAA0B;AACzB,eAAKxB,6BAAL;AACA;AACD;AACD;AAED;;;;;;;;oDAKgC;AAAA,yBACiB,KAAKY,KADtB;AAAA,UACvBC,QADuB,gBACvBA,QADuB;AAAA,UACbM,KADa,gBACbA,KADa;AAAA,UACNM,kBADM,gBACNA,kBADM;AAAA,UAEvBP,WAFuB,GAEPC,KAFO,CAEvBD,WAFuB,EAI/B;;AACA,UAAMQ,UAAU,GAAG1B,8BAA6B,CAC/CkB,WAD+C,EAE/CL,QAF+C,CAAhD;;AAIA,UAAK,CAAEjB,OAAO,CAAE8B,UAAF,EAAcR,WAAd,CAAd,EAA4C;AAC3CO,QAAAA,kBAAkB,CAAEC,UAAF,CAAlB;AACA;AACD;;;2CAEsB;AAAA,yBAKlB,KAAKd,KALa;AAAA,UAErBe,iBAFqB,gBAErBA,iBAFqB;AAAA,UAGrBC,aAHqB,gBAGrBA,aAHqB;AAAA,UAIrBd,oBAJqB,gBAIrBA,oBAJqB;AAOtB,UAAMe,WAAW,GAAG;AACnBD,QAAAA,aAAa,EAAbA,aADmB;AAEnBb,QAAAA,YAAY,EAAE,KAAKM,eAAL;AAFK,OAApB;;AAKA,UAAK,CAAEnB,cAAc,CAAEyB,iBAAF,EAAqBE,WAArB,CAArB,EAA0D;AACzDf,QAAAA,oBAAoB,CAAEe,WAAF,CAApB;AACA;AACD;;;6BAEQ;AAAA,yBAeJ,KAAKjB,KAfD;AAAA,UAEPkB,QAFO,gBAEPA,QAFO;AAAA,UAGPC,cAHO,gBAGPA,cAHO;AAAA,UAIPC,oBAJO,gBAIPA,oBAJO;AAAA,UAKPC,4BALO,gBAKPA,4BALO;AAAA,UAMPC,WANO,gBAMPA,WANO;AAAA,UAOPC,UAPO,gBAOPA,UAPO;AAAA,UAQPC,iBARO,gBAQPA,iBARO;AAAA,UASPC,YATO,gBASPA,YATO;AAAA,UAUPC,UAVO,gBAUPA,UAVO;AAAA,UAWPC,aAXO,gBAWPA,aAXO;AAAA,UAYPC,cAZO,gBAYPA,cAZO;AAAA,UAaPC,gBAbO,gBAaPA,gBAbO;AAAA,UAcPC,mBAdO,gBAcPA,mBAdO;AAAA,UAgBA/B,iBAhBA,GAgBsB,KAAKD,KAhB3B,CAgBAC,iBAhBA;AAkBR,aACC,8BACG,CAAEA,iBAAF,IACD,cAAC,SAAD;AACC,QAAA,cAAc,EAAG6B,cADlB;AAEC,QAAA,gBAAgB,EAAGC,gBAFpB;AAGC,QAAA,YAAY,EAAGX,QAHhB;AAIC,QAAA,cAAc,EAAGC,cAJlB;AAKC,QAAA,oBAAoB,EAAGC,oBALxB;AAMC,QAAA,UAAU,EAAG,KANd;AAOC,QAAA,4BAA4B,EAC3BC,4BARF;AAUC,QAAA,WAAW,EAAGC,WAVf;AAWC,QAAA,mBAAmB,EAAGQ,mBAXvB;AAYC,QAAA,UAAU,EAAGP,UAZd;AAaC,QAAA,iBAAiB,EAAGC,iBAbrB;AAcC,QAAA,YAAY,EAAGC,YAdhB;AAeC,QAAA,UAAU,EAAGC,UAfd;AAgBC,QAAA,aAAa,EAAGC;AAhBjB,QAFF,CADD;AAwBA;;;;EA3HwB1C,S;;AA8H1BW,WAAW,GAAGL,OAAO,CAAE,CACtBI,oBAAoB,CAAE,UAAEoC,OAAF;AAAA,SAAehD,IAAI,CAAEgD,OAAF,EAAW,CAAE,UAAF,CAAX,CAAnB;AAAA,CAAF,CADE,EAEtB7C,UAAU,CAAE,UAAE8C,MAAF,EAAUC,QAAV,EAAwB;AAAA,gBAQ/BD,MAAM,CAAE,mBAAF,CARyB;AAAA,MAElCE,eAFkC,WAElCA,eAFkC;AAAA,MAGlCC,qBAHkC,WAGlCA,qBAHkC;AAAA,MAIlCC,QAJkC,WAIlCA,QAJkC;AAAA,MAKlCC,oBALkC,WAKlCA,oBALkC;AAAA,MAMlCC,oBANkC,WAMlCA,oBANkC;AAAA,MAOlC7B,eAPkC,WAOlCA,eAPkC;;AAAA,MAS3BS,QAT2B,GASde,QATc,CAS3Bf,QAT2B;AAUnC,MAAMX,KAAK,GAAG6B,QAAQ,CAAElB,QAAF,CAAtB;AACA,MAAMqB,YAAY,GAAGD,oBAAoB,CAAEpB,QAAF,CAAzC;AAEA,SAAO;AACNX,IAAAA,KAAK,EAALA,KADM;AAENQ,IAAAA,iBAAiB,EAAEsB,oBAAoB,CAAEnB,QAAF,CAFjC;AAGNsB,IAAAA,UAAU,EACTjC,KAAK,CAACkC,IAAN,KAAe,eAAf,IACA,CAAEP,eAAe,CAAEhB,QAAF,CADjB,IAEA,CAAEiB,qBAAqB,CAAEjB,QAAF,EAAY,IAAZ,CANlB;AAONd,IAAAA,UAAU,EAAEK,eAAe,CAAE8B,YAAF;AAPrB,GAAP;AASA,CAtBS,CAFY,EAyBtBpD,YAAY,CAAE,UAAEuD,QAAF,EAAYT,QAAZ,EAA0B;AAAA,kBACiBS,QAAQ,CAC/D,mBAD+D,CADzB;AAAA,MAC/B7B,mBAD+B,aAC/BA,kBAD+B;AAAA,MACX8B,uBADW,aACXA,uBADW;;AAAA,MAKtCpC,KALsC,GAQnC0B,QARmC,CAKtC1B,KALsC;AAAA,MAMtCW,QANsC,GAQnCe,QARmC,CAMtCf,QANsC;AAAA,8BAQnCe,QARmC,CAOtCW,8BAPsC;AAAA,MAOtCA,8BAPsC,sCAOL,IAPK;AAUvC,SAAO;AACN/B,IAAAA,kBADM,8BACcgC,MADd,EACuB;AAC5BhC,MAAAA,mBAAkB,CACjBK,QADiB,EAEjB2B,MAFiB,EAGjBtC,KAAK,CAACD,WAAN,CAAkBE,MAAlB,KAA6B,CAA7B,IACCoC,8BAJgB,CAAlB;AAMA,KARK;AASN1C,IAAAA,oBATM,gCASgB4C,QAThB,EAS2B;AAChCJ,MAAAA,QAAQ,CAAEC,uBAAuB,CAAEzB,QAAF,EAAY4B,QAAZ,CAAzB,CAAR;AACA;AAXK,GAAP;AAaA,CAvBW,CAzBU,CAAF,CAAP,CAiDTlD,WAjDS,CAAd,C,CAmDA;;AACAA,WAAW,CAACH,oBAAZ,GAAmCA,oBAAnC;AACAG,WAAW,CAACJ,mBAAZ,GAAkCA,mBAAlC;AAEAI,WAAW,CAACmD,OAAZ,GAAsB1D,uBAAuB,CAAE;AAAA,MAAI2D,YAAJ,QAAIA,YAAJ;AAAA,SAC9C,cAAC,YAAD,OAD8C;AAAA,CAAF,CAA7C;AAIA;;;;AAGA,eAAepD,WAAf","sourcesContent":["/**\n * External dependencies\n */\nimport { pick, isEqual } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { withSelect, withDispatch } from '@wordpress/data';\nimport {\n\tsynchronizeBlocksWithTemplate,\n\twithBlockContentContext,\n} from '@wordpress/blocks';\nimport isShallowEqual from '@wordpress/is-shallow-equal';\nimport { compose } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport ButtonBlockAppender from './button-block-appender';\nimport DefaultBlockAppender from './default-block-appender';\nimport BlockList from '../block-list';\nimport { withBlockEditContext } from '../block-edit/context';\n\nclass InnerBlocks extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\t\tthis.state = {\n\t\t\ttemplateInProcess: !! this.props.template,\n\t\t};\n\t\tthis.updateNestedSettings();\n\t}\n\n\tgetTemplateLock() {\n\t\tconst { templateLock, parentLock } = this.props;\n\t\treturn templateLock === undefined ? parentLock : templateLock;\n\t}\n\n\tcomponentDidMount() {\n\t\tconst { innerBlocks } = this.props.block;\n\t\t// only synchronize innerBlocks with template if innerBlocks are empty or a locking all exists\n\t\tif ( innerBlocks.length === 0 || this.getTemplateLock() === 'all' ) {\n\t\t\tthis.synchronizeBlocksWithTemplate();\n\t\t}\n\n\t\tif ( this.state.templateInProcess ) {\n\t\t\tthis.setState( {\n\t\t\t\ttemplateInProcess: false,\n\t\t\t} );\n\t\t}\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tconst { template, block } = this.props;\n\t\tconst { innerBlocks } = block;\n\n\t\tthis.updateNestedSettings();\n\t\t// only synchronize innerBlocks with template if innerBlocks are empty or a locking all exists\n\t\tif ( innerBlocks.length === 0 || this.getTemplateLock() === 'all' ) {\n\t\t\tconst hasTemplateChanged = ! isEqual(\n\t\t\t\ttemplate,\n\t\t\t\tprevProps.template\n\t\t\t);\n\t\t\tif ( hasTemplateChanged ) {\n\t\t\t\tthis.synchronizeBlocksWithTemplate();\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Called on mount or when a mismatch exists between the templates and\n\t * inner blocks, synchronizes inner blocks with the template, replacing\n\t * current blocks.\n\t */\n\tsynchronizeBlocksWithTemplate() {\n\t\tconst { template, block, replaceInnerBlocks } = this.props;\n\t\tconst { innerBlocks } = block;\n\n\t\t// Synchronize with templates. If the next set differs, replace.\n\t\tconst nextBlocks = synchronizeBlocksWithTemplate(\n\t\t\tinnerBlocks,\n\t\t\ttemplate\n\t\t);\n\t\tif ( ! isEqual( nextBlocks, innerBlocks ) ) {\n\t\t\treplaceInnerBlocks( nextBlocks );\n\t\t}\n\t}\n\n\tupdateNestedSettings() {\n\t\tconst {\n\t\t\tblockListSettings,\n\t\t\tallowedBlocks,\n\t\t\tupdateNestedSettings,\n\t\t} = this.props;\n\n\t\tconst newSettings = {\n\t\t\tallowedBlocks,\n\t\t\ttemplateLock: this.getTemplateLock(),\n\t\t};\n\n\t\tif ( ! isShallowEqual( blockListSettings, newSettings ) ) {\n\t\t\tupdateNestedSettings( newSettings );\n\t\t}\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tclientId,\n\t\t\trenderAppender,\n\t\t\trenderFooterAppender,\n\t\t\t__experimentalMoverDirection,\n\t\t\tparentWidth,\n\t\t\thorizontal,\n\t\t\tcontentResizeMode,\n\t\t\tcontentStyle,\n\t\t\tonAddBlock,\n\t\t\tonDeleteBlock,\n\t\t\tmarginVertical,\n\t\t\tmarginHorizontal,\n\t\t\thorizontalAlignment,\n\t\t} = this.props;\n\t\tconst { templateInProcess } = this.state;\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t{ ! templateInProcess && (\n\t\t\t\t\t<BlockList\n\t\t\t\t\t\tmarginVertical={ marginVertical }\n\t\t\t\t\t\tmarginHorizontal={ marginHorizontal }\n\t\t\t\t\t\trootClientId={ clientId }\n\t\t\t\t\t\trenderAppender={ renderAppender }\n\t\t\t\t\t\trenderFooterAppender={ renderFooterAppender }\n\t\t\t\t\t\twithFooter={ false }\n\t\t\t\t\t\t__experimentalMoverDirection={\n\t\t\t\t\t\t\t__experimentalMoverDirection\n\t\t\t\t\t\t}\n\t\t\t\t\t\tparentWidth={ parentWidth }\n\t\t\t\t\t\thorizontalAlignment={ horizontalAlignment }\n\t\t\t\t\t\thorizontal={ horizontal }\n\t\t\t\t\t\tcontentResizeMode={ contentResizeMode }\n\t\t\t\t\t\tcontentStyle={ contentStyle }\n\t\t\t\t\t\tonAddBlock={ onAddBlock }\n\t\t\t\t\t\tonDeleteBlock={ onDeleteBlock }\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t</>\n\t\t);\n\t}\n}\n\nInnerBlocks = compose( [\n\twithBlockEditContext( ( context ) => pick( context, [ 'clientId' ] ) ),\n\twithSelect( ( select, ownProps ) => {\n\t\tconst {\n\t\t\tisBlockSelected,\n\t\t\thasSelectedInnerBlock,\n\t\t\tgetBlock,\n\t\t\tgetBlockListSettings,\n\t\t\tgetBlockRootClientId,\n\t\t\tgetTemplateLock,\n\t\t} = select( 'core/block-editor' );\n\t\tconst { clientId } = ownProps;\n\t\tconst block = getBlock( clientId );\n\t\tconst rootClientId = getBlockRootClientId( clientId );\n\n\t\treturn {\n\t\t\tblock,\n\t\t\tblockListSettings: getBlockListSettings( clientId ),\n\t\t\thasOverlay:\n\t\t\t\tblock.name !== 'core/template' &&\n\t\t\t\t! isBlockSelected( clientId ) &&\n\t\t\t\t! hasSelectedInnerBlock( clientId, true ),\n\t\t\tparentLock: getTemplateLock( rootClientId ),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch, ownProps ) => {\n\t\tconst { replaceInnerBlocks, updateBlockListSettings } = dispatch(\n\t\t\t'core/block-editor'\n\t\t);\n\t\tconst {\n\t\t\tblock,\n\t\t\tclientId,\n\t\t\ttemplateInsertUpdatesSelection = true,\n\t\t} = ownProps;\n\n\t\treturn {\n\t\t\treplaceInnerBlocks( blocks ) {\n\t\t\t\treplaceInnerBlocks(\n\t\t\t\t\tclientId,\n\t\t\t\t\tblocks,\n\t\t\t\t\tblock.innerBlocks.length === 0 &&\n\t\t\t\t\t\ttemplateInsertUpdatesSelection\n\t\t\t\t);\n\t\t\t},\n\t\t\tupdateNestedSettings( settings ) {\n\t\t\t\tdispatch( updateBlockListSettings( clientId, settings ) );\n\t\t\t},\n\t\t};\n\t} ),\n] )( InnerBlocks );\n\n// Expose default appender placeholders as components.\nInnerBlocks.DefaultBlockAppender = DefaultBlockAppender;\nInnerBlocks.ButtonBlockAppender = ButtonBlockAppender;\n\nInnerBlocks.Content = withBlockContentContext( ( { BlockContent } ) => (\n\t<BlockContent />\n) );\n\n/**\n * @see https://github.com/WordPress/gutenberg/blob/master/packages/block-editor/src/components/inner-blocks/README.md\n */\nexport default InnerBlocks;\n"]}