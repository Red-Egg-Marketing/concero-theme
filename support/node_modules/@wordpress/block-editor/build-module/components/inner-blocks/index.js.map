{"version":3,"sources":["@wordpress/block-editor/src/components/inner-blocks/index.js"],"names":["mapValues","pick","isEqual","classnames","withViewportMatch","Component","forwardRef","useRef","withSelect","withDispatch","getBlockType","synchronizeBlocksWithTemplate","withBlockContentContext","isShallowEqual","compose","ButtonBlockAppender","DefaultBlockAppender","BlockList","BlockContextProvider","withBlockEditContext","BLOCK_CONTEXT_CACHE","WeakMap","getBlockContext","attributes","blockType","has","set","blockTypeCache","get","context","providesContext","attributeName","InnerBlocks","arguments","state","templateInProcess","props","template","updateNestedSettings","block","templateLock","__experimentalBlocks","replaceInnerBlocks","__unstableMarkNextChangeAsNotPersistent","innerBlocks","length","setState","prevProps","isLastBlockChangePersistent","onInput","onChange","hasTemplateChanged","resetFunc","nextBlocks","blockListSettings","allowedBlocks","parentLock","__experimentalCaptureToolbars","__experimentalMoverDirection","newSettings","undefined","enableClickThrough","clientId","hasOverlay","captureToolbars","forwardedRef","classes","blockList","name","__experimentalTagName","ComposedInnerBlocks","isSmallScreen","select","ownProps","isBlockSelected","hasSelectedInnerBlock","getBlock","getBlockListSettings","getBlockRootClientId","getTemplateLock","isNavigationMode","rootClientId","dispatch","updateBlockListSettings","templateInsertUpdatesSelection","blocks","forceUpdateSelection","settings","ForwardedInnerBlocks","ref","fallbackRef","Content","BlockContent"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { mapValues, pick, isEqual } from 'lodash';\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { withViewportMatch } from '@wordpress/viewport';\nimport { Component, forwardRef, useRef } from '@wordpress/element';\nimport { withSelect, withDispatch } from '@wordpress/data';\nimport {\n\tgetBlockType,\n\tsynchronizeBlocksWithTemplate,\n\twithBlockContentContext,\n} from '@wordpress/blocks';\nimport isShallowEqual from '@wordpress/is-shallow-equal';\nimport { compose } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport ButtonBlockAppender from './button-block-appender';\nimport DefaultBlockAppender from './default-block-appender';\n\n/**\n * Internal dependencies\n */\nimport BlockList from '../block-list';\nimport { BlockContextProvider } from '../block-context';\nimport { withBlockEditContext } from '../block-edit/context';\n\n/**\n * Block context cache, implemented as a WeakMap mapping block types to a\n * WeakMap mapping attributes object to context value.\n *\n * @type {WeakMap<string,WeakMap<string,*>>}\n */\nconst BLOCK_CONTEXT_CACHE = new WeakMap();\n\n/**\n * Returns a cached context object value for a given set of attributes for the\n * block type.\n *\n * @param {Record<string,*>} attributes Block attributes object.\n * @param {WPBlockType}      blockType  Block type settings.\n *\n * @return {Record<string,*>} Context value.\n */\nfunction getBlockContext( attributes, blockType ) {\n\tif ( ! BLOCK_CONTEXT_CACHE.has( blockType ) ) {\n\t\tBLOCK_CONTEXT_CACHE.set( blockType, new WeakMap() );\n\t}\n\n\tconst blockTypeCache = BLOCK_CONTEXT_CACHE.get( blockType );\n\tif ( ! blockTypeCache.has( attributes ) ) {\n\t\tconst context = mapValues(\n\t\t\tblockType.providesContext,\n\t\t\t( attributeName ) => attributes[ attributeName ]\n\t\t);\n\n\t\tblockTypeCache.set( attributes, context );\n\t}\n\n\treturn blockTypeCache.get( attributes );\n}\n\nclass InnerBlocks extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\t\tthis.state = {\n\t\t\ttemplateInProcess: !! this.props.template,\n\t\t};\n\t\tthis.updateNestedSettings();\n\t}\n\n\tcomponentDidMount() {\n\t\tconst {\n\t\t\tblock,\n\t\t\ttemplateLock,\n\t\t\t__experimentalBlocks,\n\t\t\treplaceInnerBlocks,\n\t\t\t__unstableMarkNextChangeAsNotPersistent,\n\t\t} = this.props;\n\t\tconst { innerBlocks } = block;\n\t\t// Only synchronize innerBlocks with template if innerBlocks are empty or a locking all exists directly on the block.\n\t\tif ( innerBlocks.length === 0 || templateLock === 'all' ) {\n\t\t\tthis.synchronizeBlocksWithTemplate();\n\t\t}\n\n\t\tif ( this.state.templateInProcess ) {\n\t\t\tthis.setState( {\n\t\t\t\ttemplateInProcess: false,\n\t\t\t} );\n\t\t}\n\n\t\t// Set controlled blocks value from parent, if any.\n\t\tif ( __experimentalBlocks ) {\n\t\t\t__unstableMarkNextChangeAsNotPersistent();\n\t\t\treplaceInnerBlocks( __experimentalBlocks, false );\n\t\t}\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tconst {\n\t\t\tblock,\n\t\t\ttemplateLock,\n\t\t\ttemplate,\n\t\t\tisLastBlockChangePersistent,\n\t\t\tonInput,\n\t\t\tonChange,\n\t\t} = this.props;\n\t\tconst { innerBlocks } = block;\n\n\t\tthis.updateNestedSettings();\n\t\t// Only synchronize innerBlocks with template if innerBlocks are empty or a locking all exists directly on the block.\n\t\tif ( innerBlocks.length === 0 || templateLock === 'all' ) {\n\t\t\tconst hasTemplateChanged = ! isEqual(\n\t\t\t\ttemplate,\n\t\t\t\tprevProps.template\n\t\t\t);\n\t\t\tif ( hasTemplateChanged ) {\n\t\t\t\tthis.synchronizeBlocksWithTemplate();\n\t\t\t}\n\t\t}\n\n\t\t// Sync with controlled blocks value from parent, if possible.\n\t\tif ( prevProps.block.innerBlocks !== innerBlocks ) {\n\t\t\tconst resetFunc = isLastBlockChangePersistent ? onChange : onInput;\n\t\t\tif ( resetFunc ) {\n\t\t\t\tresetFunc( innerBlocks );\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Called on mount or when a mismatch exists between the templates and\n\t * inner blocks, synchronizes inner blocks with the template, replacing\n\t * current blocks.\n\t */\n\tsynchronizeBlocksWithTemplate() {\n\t\tconst { template, block, replaceInnerBlocks } = this.props;\n\t\tconst { innerBlocks } = block;\n\n\t\t// Synchronize with templates. If the next set differs, replace.\n\t\tconst nextBlocks = synchronizeBlocksWithTemplate(\n\t\t\tinnerBlocks,\n\t\t\ttemplate\n\t\t);\n\t\tif ( ! isEqual( nextBlocks, innerBlocks ) ) {\n\t\t\treplaceInnerBlocks( nextBlocks );\n\t\t}\n\t}\n\n\tupdateNestedSettings() {\n\t\tconst {\n\t\t\tblockListSettings,\n\t\t\tallowedBlocks,\n\t\t\tupdateNestedSettings,\n\t\t\ttemplateLock,\n\t\t\tparentLock,\n\t\t\t__experimentalCaptureToolbars,\n\t\t\t__experimentalMoverDirection,\n\t\t} = this.props;\n\n\t\tconst newSettings = {\n\t\t\tallowedBlocks,\n\t\t\ttemplateLock:\n\t\t\t\ttemplateLock === undefined ? parentLock : templateLock,\n\t\t\t__experimentalCaptureToolbars:\n\t\t\t\t__experimentalCaptureToolbars || false,\n\t\t\t__experimentalMoverDirection,\n\t\t};\n\n\t\tif ( ! isShallowEqual( blockListSettings, newSettings ) ) {\n\t\t\tupdateNestedSettings( newSettings );\n\t\t}\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tenableClickThrough,\n\t\t\tclientId,\n\t\t\thasOverlay,\n\t\t\t__experimentalCaptureToolbars: captureToolbars,\n\t\t\tforwardedRef,\n\t\t\tblock,\n\t\t\t...props\n\t\t} = this.props;\n\t\tconst { templateInProcess } = this.state;\n\n\t\tif ( templateInProcess ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst classes = classnames( {\n\t\t\t'has-overlay': enableClickThrough && hasOverlay,\n\t\t\t'is-capturing-toolbar': captureToolbars,\n\t\t} );\n\n\t\tlet blockList = (\n\t\t\t<BlockList\n\t\t\t\t{ ...props }\n\t\t\t\tref={ forwardedRef }\n\t\t\t\trootClientId={ clientId }\n\t\t\t\tclassName={ classes }\n\t\t\t/>\n\t\t);\n\n\t\t// Wrap context provider if (and only if) block has context to provide.\n\t\tconst blockType = getBlockType( block.name );\n\t\tif ( blockType && blockType.providesContext ) {\n\t\t\tconst context = getBlockContext( block.attributes, blockType );\n\n\t\t\tblockList = (\n\t\t\t\t<BlockContextProvider value={ context }>\n\t\t\t\t\t{ blockList }\n\t\t\t\t</BlockContextProvider>\n\t\t\t);\n\t\t}\n\n\t\tif ( props.__experimentalTagName ) {\n\t\t\treturn blockList;\n\t\t}\n\n\t\treturn (\n\t\t\t<div className=\"block-editor-inner-blocks\" ref={ forwardedRef }>\n\t\t\t\t{ blockList }\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nconst ComposedInnerBlocks = compose( [\n\twithViewportMatch( { isSmallScreen: '< medium' } ),\n\twithBlockEditContext( ( context ) => pick( context, [ 'clientId' ] ) ),\n\twithSelect( ( select, ownProps ) => {\n\t\tconst {\n\t\t\tisBlockSelected,\n\t\t\thasSelectedInnerBlock,\n\t\t\tgetBlock,\n\t\t\tgetBlockListSettings,\n\t\t\tgetBlockRootClientId,\n\t\t\tgetTemplateLock,\n\t\t\tisNavigationMode,\n\t\t\tisLastBlockChangePersistent,\n\t\t} = select( 'core/block-editor' );\n\t\tconst { clientId, isSmallScreen } = ownProps;\n\t\tconst block = getBlock( clientId );\n\t\tconst rootClientId = getBlockRootClientId( clientId );\n\n\t\treturn {\n\t\t\tblock,\n\t\t\tblockListSettings: getBlockListSettings( clientId ),\n\t\t\thasOverlay:\n\t\t\t\tblock.name !== 'core/template' &&\n\t\t\t\t! isBlockSelected( clientId ) &&\n\t\t\t\t! hasSelectedInnerBlock( clientId, true ),\n\t\t\tparentLock: getTemplateLock( rootClientId ),\n\t\t\tenableClickThrough: isNavigationMode() || isSmallScreen,\n\t\t\tisLastBlockChangePersistent: isLastBlockChangePersistent(),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch, ownProps ) => {\n\t\tconst {\n\t\t\treplaceInnerBlocks,\n\t\t\t__unstableMarkNextChangeAsNotPersistent,\n\t\t\tupdateBlockListSettings,\n\t\t} = dispatch( 'core/block-editor' );\n\t\tconst {\n\t\t\tblock,\n\t\t\tclientId,\n\t\t\ttemplateInsertUpdatesSelection = true,\n\t\t} = ownProps;\n\n\t\treturn {\n\t\t\treplaceInnerBlocks( blocks, forceUpdateSelection ) {\n\t\t\t\treplaceInnerBlocks(\n\t\t\t\t\tclientId,\n\t\t\t\t\tblocks,\n\t\t\t\t\tforceUpdateSelection !== undefined\n\t\t\t\t\t\t? forceUpdateSelection\n\t\t\t\t\t\t: block.innerBlocks.length === 0 &&\n\t\t\t\t\t\t\t\ttemplateInsertUpdatesSelection &&\n\t\t\t\t\t\t\t\tblocks.length !== 0\n\t\t\t\t);\n\t\t\t},\n\t\t\t__unstableMarkNextChangeAsNotPersistent,\n\t\t\tupdateNestedSettings( settings ) {\n\t\t\t\tdispatch( updateBlockListSettings( clientId, settings ) );\n\t\t\t},\n\t\t};\n\t} ),\n] )( InnerBlocks );\n\nconst ForwardedInnerBlocks = forwardRef( ( props, ref ) => {\n\tconst fallbackRef = useRef();\n\treturn (\n\t\t<ComposedInnerBlocks { ...props } forwardedRef={ ref || fallbackRef } />\n\t);\n} );\n\n// Expose default appender placeholders as components.\nForwardedInnerBlocks.DefaultBlockAppender = DefaultBlockAppender;\nForwardedInnerBlocks.ButtonBlockAppender = ButtonBlockAppender;\n\nForwardedInnerBlocks.Content = withBlockContentContext(\n\t( { BlockContent } ) => <BlockContent />\n);\n\n/**\n * @see https://github.com/WordPress/gutenberg/blob/master/packages/block-editor/src/components/inner-blocks/README.md\n */\nexport default ForwardedInnerBlocks;\n"]}