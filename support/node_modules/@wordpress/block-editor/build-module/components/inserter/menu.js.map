{"version":3,"sources":["@wordpress/block-editor/src/components/inserter/menu.js"],"names":["includes","pick","useState","LEFT","RIGHT","UP","DOWN","BACKSPACE","ENTER","TabPanel","__","useSelect","useDispatch","isUnmodifiedDefaultBlock","Tips","InserterSearchForm","InserterPreviewPanel","InserterBlockList","BlockPatterns","stopKeyPropagation","event","stopPropagation","InserterMenu","rootClientId","clientId","isAppender","__experimentalSelectBlockOnInsert","onSelect","showInserterHelpPanel","filterValue","setFilterValue","hoveredItem","setHoveredItem","select","getSettings","getBlockRootClientId","_getBlockSelectionEnd","getBlockSelectionEnd","destRootClientId","end","undefined","patterns","__experimentalBlockPatterns","destinationRootClientId","getSelectedBlock","getBlockIndex","getBlockOrder","replaceBlocks","insertBlocks","showInsertionPoint","hideInsertionPoint","hasPatterns","length","onKeyDown","keyCode","getInsertionIndex","onInsertBlocks","blocks","selectedBlock","onHover","item","index","blocksTab","patternsTab","name","title","tab"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { includes, pick } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { useState } from '@wordpress/element';\nimport { LEFT, RIGHT, UP, DOWN, BACKSPACE, ENTER } from '@wordpress/keycodes';\nimport { TabPanel } from '@wordpress/components';\nimport { __ } from '@wordpress/i18n';\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { isUnmodifiedDefaultBlock } from '@wordpress/blocks';\n\n/**\n * Internal dependencies\n */\nimport Tips from './tips';\nimport InserterSearchForm from './search-form';\nimport InserterPreviewPanel from './preview-panel';\nimport InserterBlockList from './block-list';\nimport BlockPatterns from './block-patterns';\n\nconst stopKeyPropagation = ( event ) => event.stopPropagation();\n\nfunction InserterMenu( {\n\trootClientId,\n\tclientId,\n\tisAppender,\n\t__experimentalSelectBlockOnInsert,\n\tonSelect,\n\tshowInserterHelpPanel,\n} ) {\n\tconst [ filterValue, setFilterValue ] = useState( '' );\n\tconst [ hoveredItem, setHoveredItem ] = useState( null );\n\tconst {\n\t\tdestinationRootClientId,\n\t\tpatterns,\n\t\tgetSelectedBlock,\n\t\tgetBlockIndex,\n\t\tgetBlockSelectionEnd,\n\t\tgetBlockOrder,\n\t} = useSelect( ( select ) => {\n\t\tconst {\n\t\t\tgetSettings,\n\t\t\tgetBlockRootClientId,\n\t\t\tgetBlockSelectionEnd: _getBlockSelectionEnd,\n\t\t} = select( 'core/block-editor' );\n\n\t\tlet destRootClientId = rootClientId;\n\t\tif ( ! destRootClientId && ! clientId && ! isAppender ) {\n\t\t\tconst end = _getBlockSelectionEnd();\n\t\t\tif ( end ) {\n\t\t\t\tdestRootClientId = getBlockRootClientId( end ) || undefined;\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\tpatterns: getSettings().__experimentalBlockPatterns,\n\t\t\tdestinationRootClientId: destRootClientId,\n\t\t\t...pick( select( 'core/block-editor' ), [\n\t\t\t\t'getSelectedBlock',\n\t\t\t\t'getBlockIndex',\n\t\t\t\t'getBlockSelectionEnd',\n\t\t\t\t'getBlockOrder',\n\t\t\t] ),\n\t\t};\n\t}, [] );\n\tconst {\n\t\treplaceBlocks,\n\t\tinsertBlocks,\n\t\tshowInsertionPoint,\n\t\thideInsertionPoint,\n\t} = useDispatch( 'core/block-editor' );\n\tconst hasPatterns =\n\t\t! destinationRootClientId && !! patterns && !! patterns.length;\n\tconst onKeyDown = ( event ) => {\n\t\tif (\n\t\t\tincludes(\n\t\t\t\t[ LEFT, DOWN, RIGHT, UP, BACKSPACE, ENTER ],\n\t\t\t\tevent.keyCode\n\t\t\t)\n\t\t) {\n\t\t\t// Stop the key event from propagating up to ObserveTyping.startTypingInTextField.\n\t\t\tevent.stopPropagation();\n\t\t}\n\t};\n\n\t// To avoid duplication, getInsertionIndex is extracted and used in two event handlers\n\t// This breaks the withDispatch not containing any logic rule.\n\t// Since it's a function only called when the event handlers are called,\n\t// it's fine to extract it.\n\t// eslint-disable-next-line no-restricted-syntax\n\tfunction getInsertionIndex() {\n\t\t// If the clientId is defined, we insert at the position of the block.\n\t\tif ( clientId ) {\n\t\t\treturn getBlockIndex( clientId, destinationRootClientId );\n\t\t}\n\n\t\t// If there a selected block, we insert after the selected block.\n\t\tconst end = getBlockSelectionEnd();\n\t\tif ( ! isAppender && end ) {\n\t\t\treturn getBlockIndex( end, destinationRootClientId ) + 1;\n\t\t}\n\n\t\t// Otherwise, we insert at the end of the current rootClientId\n\t\treturn getBlockOrder( destinationRootClientId ).length;\n\t}\n\n\tconst onInsertBlocks = ( blocks ) => {\n\t\tconst selectedBlock = getSelectedBlock();\n\t\tif (\n\t\t\t! isAppender &&\n\t\t\tselectedBlock &&\n\t\t\tisUnmodifiedDefaultBlock( selectedBlock )\n\t\t) {\n\t\t\treplaceBlocks( selectedBlock.clientId, blocks );\n\t\t} else {\n\t\t\tinsertBlocks(\n\t\t\t\tblocks,\n\t\t\t\tgetInsertionIndex(),\n\t\t\t\tdestinationRootClientId,\n\t\t\t\t__experimentalSelectBlockOnInsert\n\t\t\t);\n\t\t}\n\n\t\tonSelect();\n\t};\n\n\tconst onHover = ( item ) => {\n\t\tsetHoveredItem( item );\n\t\tif ( item ) {\n\t\t\tconst index = getInsertionIndex();\n\t\t\tshowInsertionPoint( destinationRootClientId, index );\n\t\t} else {\n\t\t\thideInsertionPoint();\n\t\t}\n\t};\n\n\tconst blocksTab = (\n\t\t<>\n\t\t\t<div className=\"block-editor-inserter__block-list\">\n\t\t\t\t<div className=\"block-editor-inserter__scrollable\">\n\t\t\t\t\t<InserterBlockList\n\t\t\t\t\t\trootClientId={ destinationRootClientId }\n\t\t\t\t\t\tonInsert={ onInsertBlocks }\n\t\t\t\t\t\tonHover={ onHover }\n\t\t\t\t\t\t__experimentalSelectBlockOnInsert={\n\t\t\t\t\t\t\t__experimentalSelectBlockOnInsert\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfilterValue={ filterValue }\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t{ showInserterHelpPanel && (\n\t\t\t\t<div className=\"block-editor-inserter__tips\">\n\t\t\t\t\t<Tips />\n\t\t\t\t</div>\n\t\t\t) }\n\t\t</>\n\t);\n\n\tconst patternsTab = (\n\t\t<div className=\"block-editor-inserter__scrollable\">\n\t\t\t<BlockPatterns\n\t\t\t\tpatterns={ patterns }\n\t\t\t\tonInsert={ onInsertBlocks }\n\t\t\t\tfilterValue={ filterValue }\n\t\t\t/>\n\t\t</div>\n\t);\n\n\t// Disable reason (no-autofocus): The inserter menu is a modal display, not one which\n\t// is always visible, and one which already incurs this behavior of autoFocus via\n\t// Popover's focusOnMount.\n\t// Disable reason (no-static-element-interactions): Navigational key-presses within\n\t// the menu are prevented from triggering WritingFlow and ObserveTyping interactions.\n\t/* eslint-disable jsx-a11y/no-autofocus, jsx-a11y/no-static-element-interactions */\n\treturn (\n\t\t<div\n\t\t\tclassName=\"block-editor-inserter__menu\"\n\t\t\tonKeyPress={ stopKeyPropagation }\n\t\t\tonKeyDown={ onKeyDown }\n\t\t>\n\t\t\t<div className=\"block-editor-inserter__main-area\">\n\t\t\t\t<InserterSearchForm onChange={ setFilterValue } />\n\t\t\t\t{ hasPatterns && (\n\t\t\t\t\t<TabPanel\n\t\t\t\t\t\tclassName=\"block-editor-inserter__tabs\"\n\t\t\t\t\t\ttabs={ [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'blocks',\n\t\t\t\t\t\t\t\t/* translators: Blocks tab title in the block inserter. */\n\t\t\t\t\t\t\t\ttitle: __( 'Blocks' ),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'patterns',\n\t\t\t\t\t\t\t\t/* translators: Patterns tab title in the block inserter. */\n\t\t\t\t\t\t\t\ttitle: __( 'Patterns' ),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t] }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ ( tab ) => {\n\t\t\t\t\t\t\tif ( tab.name === 'blocks' ) {\n\t\t\t\t\t\t\t\treturn blocksTab;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn patternsTab;\n\t\t\t\t\t\t} }\n\t\t\t\t\t</TabPanel>\n\t\t\t\t) }\n\t\t\t\t{ ! hasPatterns && blocksTab }\n\t\t\t</div>\n\t\t\t{ showInserterHelpPanel && hoveredItem && (\n\t\t\t\t<div className=\"block-editor-inserter__preview-container\">\n\t\t\t\t\t<InserterPreviewPanel item={ hoveredItem } />\n\t\t\t\t</div>\n\t\t\t) }\n\t\t</div>\n\t);\n\t/* eslint-enable jsx-a11y/no-autofocus, jsx-a11y/no-static-element-interactions */\n}\n\nexport default InserterMenu;\n"]}